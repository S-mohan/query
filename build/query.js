/*!
 * query 1.0.0
 * (c) 2018 Smohan<https://smohan.net>
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Query",[],e):"object"==typeof exports?exports.Query=e():t.Query=e()}(this,function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=Object.prototype.toString,s=Object.prototype.hasOwnProperty,o=["string","number","boolean","symbol"],a=function(t){return"[object RegExp]"===n.call(t)},u=function(t){return"string"==typeof t},c=function(t){return void 0===t},f=function(t){return null===t},l=function(t){return!!(c(t)||f(t)||u(t)&&0===t.trim().length)},p=function(t){return"[object Object]"===n.call(t)},h=function(t){return Array.isArray.call(null,t)},g=function(t){return!!~o.indexOf(void 0===t?"undefined":i(t))},d=function(t){return"number"==typeof t},v=/(\^|\.|\[|\$|\(|\)|\||\*|\+|\?|\{|\\)/g;var y={regex:function(t,e){if(!a(t))throw TypeError("[VALIDATE ERROR]: The parameter reg must be a RegExp object");return!!t.test(e)},isRegexp:a,isString:u,isUndefined:c,isNull:f,isEmpty:l,isObject:function(t){return!f(t)&&"object"===(void 0===t?"undefined":i(t))},isPlainObject:p,isArray:h,isPrimitive:g,isFullPrimitive:function(t){return f(t)||c(t)||g(t)},isFunction:function(t){return"function"==typeof t},isNumber:d,isInteger:function(t){return d(t)&&t%1==0},isFloat:function(t){return+t&&t!==(0|t)},isBoolean:function(t){return"boolean"==typeof t},escapeKeyword:function(t){return(t||"").toString().replace(v,"\\$1")},getObjectValue:function(t,e){if(!l(t)){for(var r=t.split(".");r.length&&(e=e[r.shift()],p(e)||h(e)););return e}},objKeyIsExists:function(t,e){if(l(t))return!1;for(var r=t.split(".");r.length;){var i=r.shift();if(!s.call(e,i))return!1;e=e[i]}return!0}},b=["eq","neq","gt","gte","lt","lte","like","in","nin","exists","custom"],m=["and","or"],O=["asc","desc"],j={index:[],groupKeySeparator:"$"};function x(t,e){if(!(this instanceof x))return new x(t,e);y.isArray(t),this.source=t,this.options=Object.assign(Object.create(null),j,e),this.reset()}x.version="1.0.0";var S=x.prototype;function k(t){var e=this.params.query,r=e.length;if(0===r)return!0;for(var i=!0,n=0;n<r;n++){var s=e[n],o=s._f,a=s._c,u=s._e,c=s._r,f=void 0;if("exists"===u)f=y.objKeyIsExists(o,t);else{var l=y.getObjectValue(o,t);f="custom"===u&&y.isFunction(a)?a.call(null,l):w(l,u,a)}i="or"===c?i||f:i&&f}return i}function w(t,e,r){var i=!0;switch(e){case"like":var n=new RegExp(y.escapeKeyword(r),"i");i=!!(t||"").toString().match(n);break;case"in":y.isPrimitive(r)&&(r=[r]),i=!!y.isArray(r)&&!!~r.indexOf(t);break;case"nin":y.isPrimitive(r)&&(r=[r]),y.isArray(r)&&(i=!1==!!~r.indexOf(t));break;case"neq":i=t!==r;break;case"lt":i=t<r;break;case"lte":i=t<=r;break;case"gt":i=t>r;break;case"gte":i=t>=r;break;case"eq":default:i=t===r}return i}function _(t,e){for(var r=this.params.sort,i=r.length,n=void 0;--i>=0;){if(r[i][0]===t){n=i;break}}var s=[t,e];n>-1&&this.params.sort.splice(n,1),this.params.sort.push(s)}function q(){var t=this.target,e=this.params,r=this.queried,i=this.options,n=e.group;if(!r){for(var s=[],o=Object.create(null),a=n&&n.length,u=-1,c=t.length,f=void 0;++u<c;){if(f=t[u],k.call(this,f))if(a){for(var l=[],p=0;p<a;p++){var h=n[p],g=y.getObjectValue(h,f);void 0!==g&&l.push(g)}var d=l.join(i.groupKeySeparator);o[d]||(o[d]=[]),o[d].push(f)}else s.push(f)}if(a)for(var v in s.length=0,o){var b=o[v];s.push({_id:v,list:b,count:b.length})}this.queried=!0,this.target=s}}S.range=function(t,e){return this},S.skip=function(t){return this.params.skip=y.isInteger(t)&&t>0?t:0,this},S.limit=function(t){return this.params.limit=y.isInteger(t)?Math.abs(t):void 0,this},S.where=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"exists",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"and";if(!y.isString(t)||y.isEmpty(t))return this;if(!y.isFullPrimitive(r)&&!y.isFunction(r))throw new TypeError("Query: condition 必须是个基本类型值或者函数");e=e.toLocaleLowerCase(),i=i.toLocaleLowerCase();var n={_f:t,_c:r,_e:e=~b.indexOf(e)?e:"exists",_r:i=~m.indexOf(i)?i:"and"};return~JSON.stringify(this.params.query).indexOf(JSON.stringify(n))||this.params.query.push(n),this},S.sort=function(t,e){var r=Object.create(null);for(var i in 1===arguments.length?y.isPlainObject(t)?r=t:r[t]="desc":r[t]=e,r){var n=r[i].toLocaleLowerCase();y.isString(i)&&~O.indexOf(n)&&_.call(this,i,n)}return this},S.count=function(){return q.call(this),this.target.length},S.find=function(){q.call(this);var t=this.target,e=this.params.sort.length,r=this.params,i=r.skip,n=r.limit;e&&function(t){var e=this.params.sort;t.sort(function(t,r){for(var i=-1,n=e.length,s=void 0;++i<n;){var o=(s=e[i])[0],a=s[1],u=y.getObjectValue(o,t),c=y.getObjectValue(o,r);if(u>c)return"desc"===a?-1:1;if(u<c)return"asc"===a?-1:1}})}.call(this,t);var s=t.length;if(0!==s){var o=i,a=void 0;return void 0===o&&(o=0),o=Math.min(o,s),a=void 0===n?s:o+n,a=Math.min(a,s),t=t.slice(o,a)}this.target=[]},S.group=function(t){return!1==!!~this.params.group.indexOf(t)&&this.params.group.push(t),this},S.reset=function(){var t,e=this.source;return this.target=(t=e,JSON.parse(JSON.stringify(t))),this.params=Object.create(null),this.params.query=[],this.params.sort=[],this.params.field=Object.create(null),this.params.group=[],this.queried=!1,this.indexes=Object.create(null),this},S.destroy=function(){this.target=null,this.params=null};var E=x;r.d(e,"default",function(){return E})}]).default});