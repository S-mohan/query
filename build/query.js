/*!
 * query 1.0.0
 * (c) 2018 Smohan<https://smohan.net>
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Query",[],e):"object"==typeof exports?exports.Query=e():t.Query=e()}(this,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=Object.prototype.toString,a=Object.prototype.hasOwnProperty,o=Array.prototype.slice,s=["string","number","boolean","symbol"],u=function(t){return"[object RegExp]"===i.call(t)},c=function(t){return"string"==typeof t},l=function(t){return void 0===t},f=function(t){return null===t},p=function(t){return!!(l(t)||f(t)||c(t)&&0===t.trim().length)},h=function(t){return"[object Object]"===i.call(t)},g=function(t){return Array.isArray.call(null,t)},d=function(t){return!!~s.indexOf(void 0===t?"undefined":n(t))},y=function(t){return"number"==typeof t},v=/(\^|\.|\[|\$|\(|\)|\||\*|\+|\?|\{|\\)/g;var m=function(t,e){return a.call(e,t)};var b={regex:function(t,e){if(!u(t))throw TypeError("[VALIDATE ERROR]: The parameter reg must be a RegExp object");return!!t.test(e)},isRegexp:u,isString:c,isUndefined:l,isNull:f,isEmpty:p,isObject:function(t){return!f(t)&&"object"===(void 0===t?"undefined":n(t))},isPlainObject:h,isArray:g,isPrimitive:d,isFullPrimitive:function(t){return f(t)||l(t)||d(t)},isFunction:function(t){return"function"==typeof t},isNumber:y,isInteger:function(t){return y(t)&&t%1==0},isFloat:function(t){return+t&&t!==(0|t)},isBoolean:function(t){return"boolean"==typeof t},escapeKeyword:function(t){return(t||"").toString().replace(v,"\\$1")},getObjectValue:function(t,e){if(!p(t)){for(var r=t.split(".");r.length&&(e=e[r.shift()],h(e)||g(e)););return e}},objKeyIsExists:function(t,e){if(p(t))return!1;for(var r=t.split(".");r.length;){var n=r.shift();if(!m(n,e))return!1;e=e[n]}return!0},hasKey:m,apply:function(t,e){var r=o.call(arguments,2);switch(r.length){case 0:case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2]);default:return t.apply(e,r)}},toArray:function(t){return o.call(t)}},O=function(t){return{y:(t=function(t){return t instanceof Date?t:/^\d+$/.test(t)?new Date(parseInt(t,10)):(t=(t||"").trim().replace(/\.\d+/,"").replace(/-/g,"/").replace(/T/," ").replace(/Z/," UTC").replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(t))}(t)).getFullYear(),M:t.getMonth()+1,d:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),q:Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()}},j=function(t){if(b.isNumber(t))return t;var e=parseFloat(t,10);return isNaN(e)?t:e},x=function(t){return String(t)},w={date:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yy-MM-dd hh:mm:ss",r=O(t);return e=e.replace(/([yMdhmsqS])+/g,function(t,e){var n=r[e];return void 0!==n&&(n=n.toString(),"y"!==e&&t.length>1?n=(n="0"+n).substr(n.length-2):"y"===e&&1===t.length&&(n=n.substr(2))),n})},number:j,int:function(t){var e=j(t);return isNaN(e)?t:parseInt(t,10)},zero:function(t){return t||0},boolean:function(t){return!!t},string:x,lower:function(t){return x(t).toLocaleLowerCase()},upper:function(t){return x(t).toLocaleUpperCase()}};function S(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var A=["eq","neq","gt","gte","lt","lte","like","in","nin","exists","custom"],k=["and","or"],M=["asc","desc"],P=Object.keys(w),q=Object.create(null);P.forEach(function(t){q[t]=function(e){return b.apply.apply(b,[w[t],e].concat(S(b.toArray(arguments))))}});var E={index:[],groupKeySeparator:"$",newFieldNamePrefix:"$"};function N(t,e){if(!(this instanceof N))return new N(t,e);b.isArray(t),this.source=t,this.options=Object.assign(Object.create(null),E,e),this.reset()}N.version="1.0.0",N.hooks=function(t,e){!1==!!~P.indexOf(t)&&b.isFunction(e)&&(q[t]=function(t){return b.apply.apply(b,[e,t].concat(S(b.toArray(arguments))))})};var _=N.prototype,F={args:null,new:!1};function L(t){var e=this.params.query,r=e.length;if(0===r)return!0;for(var n=!0,i=0;i<r;i++){var a=e[i],o=a._f,s=a._c,u=a._e,c=a._r,l=void 0;if("exists"===u)l=b.objKeyIsExists(o,t);else{var f=b.getObjectValue(o,t);l="custom"===u&&b.isFunction(s)?s.call(null,f):I(f,u,s)}n="or"===c?n||l:n&&l}return n}function I(t,e,r){var n=!0;switch(e){case"like":var i=new RegExp(b.escapeKeyword(r),"i");n=!!(t||"").toString().match(i);break;case"in":b.isPrimitive(r)&&(r=[r]),n=!!b.isArray(r)&&!!~r.indexOf(t);break;case"nin":b.isPrimitive(r)&&(r=[r]),b.isArray(r)&&(n=!1==!!~r.indexOf(t));break;case"neq":n=t!==r;break;case"lt":n=t<r;break;case"lte":n=t<=r;break;case"gt":n=t>r;break;case"gte":n=t>=r;break;case"eq":default:n=t===r}return n}function K(t,e){for(var r=this.params.sort,n=r.length,i=void 0;--n>=0;){if(r[n][0]===t){i=n;break}}var a=[t,e];i>-1&&this.params.sort.splice(i,1),this.params.sort.push(a)}function V(){var t=this.target,e=this.params,r=this.queried,n=this.options,i=e.group;if(!r){for(var a=[],o=Object.create(null),s=i&&i.length,u=-1,c=t.length,l=void 0;++u<c;){if(l=R.call(this,t[u]),L.call(this,l))if(s){for(var f=[],p=0;p<s;p++){var h=i[p],g=b.getObjectValue(h,l);void 0!==g&&f.push(g)}var d=f.join(n.groupKeySeparator);o[d]||(o[d]=[]),o[d].push(l)}else a.push(l)}if(s)for(var y in a.length=0,o){var v=o[y];a.push({_id:y,list:v,count:v.length})}this.queried=!0,this.target=a}}function R(t){var e=this.params,r=this.options;if(e.format)for(var n in e.format){var i=e.format[n],a=b.getObjectValue(n,t),o=i.handler.apply(i,[a].concat(S(i.args))),s=n.split("."),u=s.slice(0,s.length-1).join("."),c=s[s.length-1],l=t;if(u){var f=b.getObjectValue(u,t);(b.isPlainObject(f)||b.isArray(f))&&(l=f)}if(i.new)l[r.newFieldNamePrefix+(b.isString(i.new)?i.new:c)]=o;else l[c]=o}return t}_.to=_.format=function(t,e,r){if(r=Object.assign(Object.create(null),F,r),b.hasKey(e,q)){var n=[];b.isUndefined(r.args)||(b.isArray(r.args)?r.args.forEach(function(t){return n.push(t)}):n.push(r.args)),this.params.format[t]={args:n,handler:q[e],new:r.new}}return this},_.range=function(t,e){return this},_.skip=function(t){return this.params.skip=b.isInteger(t)&&t>0?t:0,this},_.limit=function(t){return this.params.limit=b.isInteger(t)?Math.abs(t):void 0,this},_.where=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"exists",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"and";if(!b.isString(t)||b.isEmpty(t))return this;if(!b.isFullPrimitive(r)&&!b.isFunction(r))throw new TypeError("Query: condition 必须是个基本类型值或者函数");e=e.toLocaleLowerCase(),n=n.toLocaleLowerCase();var i={_f:t,_c:r,_e:e=~A.indexOf(e)?e:"exists",_r:n=~k.indexOf(n)?n:"and"};return~JSON.stringify(this.params.query).indexOf(JSON.stringify(i))||this.params.query.push(i),this},_.sort=function(t,e){var r=Object.create(null);for(var n in 1===arguments.length?b.isPlainObject(t)?r=t:r[t]="desc":r[t]=e,r){var i=r[n].toLocaleLowerCase();b.isString(n)&&~M.indexOf(i)&&K.call(this,n,i)}return this},_.count=function(){return V.call(this),this.target.length},_.find=function(){V.call(this);var t=this.target,e=this.params.sort.length,r=this.params,n=r.skip,i=r.limit;e&&function(t){var e=this.params.sort;t.sort(function(t,r){for(var n=-1,i=e.length,a=void 0;++n<i;){var o=(a=e[n])[0],s=a[1],u=b.getObjectValue(o,t),c=b.getObjectValue(o,r);if(u>c)return"desc"===s?-1:1;if(u<c)return"asc"===s?-1:1}})}.call(this,t);var a=t.length;if(0!==a){var o=n,s=void 0;return void 0===o&&(o=0),o=Math.min(o,a),s=void 0===i?a:o+i,s=Math.min(s,a),t=t.slice(o,s)}this.target=[]},_.group=function(t){return!1==!!~this.params.group.indexOf(t)&&this.params.group.push(t),this},_.reset=function(){var t,e=this.source;return this.target=(t=e,JSON.parse(JSON.stringify(t))),this.params=Object.create(null),this.params.query=[],this.params.sort=[],this.params.field=Object.create(null),this.params.group=[],this.params.format=Object.create(null),this.queried=!1,this.indexes=Object.create(null),this},_.destroy=function(){this.target=null,this.params=null};var $=N;r.d(e,"default",function(){return $})}]).default});