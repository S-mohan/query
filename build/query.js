/*!
 * query 1.0.2
 * (c) 2018 Smohan<https://smohan.net>
 * Released under the MIT License.
 */
!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("Query",[],r):"object"==typeof exports?exports.Query=r():t.Query=r()}(this,function(){return function(t){var r={};function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=0)}([function(t,r,e){"use strict";e.r(r);var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=Object.prototype.toString,a=Object.prototype.hasOwnProperty,s=Array.prototype.slice,o=["string","number","boolean","symbol"],u=function(t){return"string"==typeof t},c=function(t){return void 0===t},l=function(t){return null===t},f=function(t){return!!(c(t)||l(t)||u(t)&&0===t.trim().length)},p=function(t){return"[object Object]"===i.call(t)},h=function(t){return Array.isArray.call(null,t)},g=function(t){return!!~o.indexOf(void 0===t?"undefined":n(t))},d=function(t){return"number"==typeof t},y=/(\^|\.|\[|\$|\(|\)|\||\*|\+|\?|\{|\\)/g;var v=function(t,r){return a.call(r,t)};var m={isRegexp:function(t){return"[object RegExp]"===i.call(t)},isString:u,isUndefined:c,isNull:l,isEmpty:f,isObject:function(t){return!l(t)&&"object"===(void 0===t?"undefined":n(t))},isPlainObject:p,isArray:h,isPrimitive:g,isFullPrimitive:function(t){return l(t)||c(t)||g(t)},isFunction:function(t){return"function"==typeof t},isNumber:d,isInteger:function(t){return d(t)&&t%1==0},isFloat:function(t){return+t&&t!==(0|t)},isBoolean:function(t){return"boolean"==typeof t},escapeKeyword:function(t){return(t||"").toString().replace(y,"\\$1")},getObjectValue:function(t,r){if(!f(t)){for(var e=t.split(".");e.length&&(r=r[e.shift()],p(r)||h(r)););return r}},objKeyIsExists:function(t,r){if(f(t))return!1;for(var e=t.split(".");e.length;){var n=e.shift();if(!v(n,r))return!1;r=r[n]}return!0},hasKey:v,apply:function(t,r){var e=s.call(arguments,2);switch(e.length){case 0:case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2]);default:return t.apply(r,e)}},toArray:function(t){return s.call(t)}},b=function(t){return{y:(t=function(t){return t instanceof Date?t:/^\d+$/.test(t)?new Date(parseInt(t,10)):(t=(t||"").trim().replace(/\.\d+/,"").replace(/-/g,"/").replace(/T/," ").replace(/Z/," UTC").replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(t))}(t)).getFullYear(),M:t.getMonth()+1,d:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),q:Math.floor((t.getMonth()+3)/3)}},O=function(t){return m.isNumber(t)?t:+t},j=function(t){return m.isString(t)?t:t+""},x={date:function(t,r){t=t||new Date,r=r||"yy-MM-dd hh:mm:ss";var e=b(t);return r=r.replace(/([yMdhmsqS])+/g,function(t,r){var n=e[r];return void 0!==n&&(n=n.toString(),"y"!==r&&t.length>1?n=(n="0"+n).substr(n.length-2):"y"===r&&1===t.length&&(n=n.substr(2))),n})},number:O,int:function(t){var r=O(t);return isNaN(r)?t:parseInt(t,10)},zero:function(t){return t||0},boolean:function(t){return!!t},string:j,lower:function(t){return j(t).toLocaleLowerCase()},upper:function(t){return j(t).toLocaleUpperCase()}};function w(t){if(Array.isArray(t)){for(var r=0,e=Array(t.length);r<t.length;r++)e[r]=t[r];return e}return Array.from(t)}var S=["eq","=","neq","<>","gt",">","gte",">=","lt","<","lte","<=","like","in","nin","exists"],A=["asc","desc"],k=["and","or"],q=Object.keys(x),_=Object.create(null);q.forEach(function(t){_[t]=function(r){return m.apply.apply(m,[x[t],r].concat(w(m.toArray(arguments))))}});var M={index:[],groupKeySeparator:"$",newFieldNamePrefix:"$"};function P(t,r){if(!(this instanceof P))return new P(t,r);m.isArray(t)||(D("data must be an array"),t=[]),this.source=t,this.options=Object.assign(Object.create(null),M,r),this.reset()}P.version="1.0.2",P.hooks=function(t,r){!1==!!~q.indexOf(t)&&m.isFunction(r)&&(_[t]=function(t){return m.apply.apply(m,[r,t].concat(w(m.toArray(arguments))))})};var N=P.prototype,E={args:null,new:!1,handler:null};function F(t,r,e,n){if(m.isString(t)&&!m.isEmpty(t)&&!1!=!!~S.indexOf(r)){if(e&&m.isRegexp(e)){var i=e;e=function(t){return!!i.test(t)}}m.isFunction(e)&&(r="eq");var a={_f:t,_c:e,_e:r,_r:n=~k.indexOf(n)?n:"and"};return~JSON.stringify(this.params.query).indexOf(JSON.stringify(a))?void 0:a}}function I(t){var r=this.params.query,e=r.length;if(0===e)return!0;for(var n=!0,i=void 0,a=0;a<e;a++){i=r[a];var s=void 0,o=K(s=m.isArray(i)?i:[i],t);n="or"===s[0]._r?n||o:n&&o}return n}function K(t,r){for(var e=!0,n=-1,i=t.length;++n<i;){var a=t[n],s=a._f,o=a._c,u=a._e,c=a._r,l=void 0;if("exists"===u)l=m.objKeyIsExists(s,r);else{var f=m.getObjectValue(s,r);l=m.isFunction(o)?o.call(null,f):R(f,u,o)}e="or"===c?e||l:e&&l}return e}function R(t,r,e){var n=!0;switch(r){case"like":var i=new RegExp(m.escapeKeyword(e),"i");n=!!(t||"").toString().match(i);break;case"in":m.isPrimitive(e)&&(e=[e]),n=!!m.isArray(e)&&!!~e.indexOf(t);break;case"nin":m.isPrimitive(e)&&(e=[e]),m.isArray(e)&&(n=!1==!!~e.indexOf(t));break;case"neq":case"<>":n=t!==e;break;case"lt":case"<":n=t<e;break;case"lte":case"<=":n=t<=e;break;case"gt":case">":n=t>e;break;case"gte":case">=":n=t>=e;break;case"eq":case"=":default:n=t===e}return n}function U(t,r){for(var e=this.params.sort,n=e.length,i=void 0;--n>=0;){if(e[n][0]===t){i=n;break}}var a=[t,r];i>-1&&this.params.sort.splice(i,1),this.params.sort.push(a)}function V(){var t=this.target,r=this.params,e=this.queried,n=this.options,i=r.group,a=r.range;if(!e){var s=[],o=Object.create(null),u=i&&i.length,c=a[0],l=a[1],f=-1,p=t.length;if(!m.isUndefined(c)||!m.isUndefined(l)){if(c>l){var h=[l,c];c=h[0],l=h[1]}c>p-1&&(c=p-1),l>p-1&&(l=p-1),p=(t=t.slice(c,l)).length}for(var g=void 0;++f<p;){if(g=$.call(this,t[f]),I.call(this,g))if(u){for(var d=[],y=0;y<u;y++){var v=i[y],b=m.getObjectValue(v,g);void 0!==b&&d.push(b)}var O=d.join(n.groupKeySeparator);o[O]||(o[O]=[]),o[O].push(g)}else s.push(g)}if(u)for(var j in s.length=0,o){var x=o[j];s.push({_id:j,list:x,count:x.length})}this.queried=!0,this.target=s}}function $(t){var r=this.params,e=this.options;if(r.format)try{for(var n in r.format){var i=r.format[n],a=m.getObjectValue(n,t),s=i.handler.apply(i,[a].concat(w(i.args))),o=n.split("."),u=o.slice(0,o.length-1).join("."),c=o[o.length-1],l=t;if(u){var f=m.getObjectValue(u,t);(m.isPlainObject(f)||m.isArray(f))&&(l=f)}if(i.new)l[e.newFieldNamePrefix+(m.isString(i.new)?i.new:c)]=s;else l[c]=s}}catch(t){D(t)}return t}function D(t){console.log("[QUERY ERROR]:",t)}N.to=N.format=function(t,r,e){var n=void 0;if((e=Object.assign(Object.create(null),E,e)).handler&&m.isFunction(e.handler)?n=e.handler:m.hasKey(r,_)&&(n=_[r]),n){var i=[];m.isUndefined(e.args)||(m.isArray(e.args)?e.args.forEach(function(t){return i.push(t)}):i.push(e.args)),this.params.format[t]={args:i,handler:n,new:e.new}}return this},N.range=function(t,r){return m.isInteger(t)&&t>=0&&(this.params.range[0]=t),m.isInteger(r)&&r>=0&&(this.params.range[1]=r),this},N.skip=function(t){return this.params.skip=m.isInteger(t)&&t>0?t:0,this},N.limit=function(t){return this.params.limit=m.isInteger(t)?Math.abs(t):void 0,this},N.where=function(t,r,e,n){if(m.isArray(arguments[0])){for(var i=arguments[0].length,a=-1,s=[];++a<i;){var o=arguments[0][a];if(m.isArray(o)){var u=F.call(this,o[0],o[1],o[2],o[3]);u&&s.push(u)}}s.length&&this.params.query.push(s)}else{var c=F.call(this,t,r,e,n);c&&this.params.query.push(c)}return this},N.sort=function(t,r){var e=Object.create(null);for(var n in 1===arguments.length?m.isPlainObject(t)?e=t:e[t]="desc":e[t]=r,e){var i=e[n].toLocaleLowerCase();m.isString(n)&&~A.indexOf(i)&&U.call(this,n,i)}return this},N.count=function(){return V.call(this),this.target.length},N.find=function(){V.call(this);var t=this.target,r=this.params.sort.length,e=this.params,n=e.skip,i=e.limit;r&&function(t){var r=this.params.sort;t.sort(function(t,e){for(var n=-1,i=r.length,a=void 0;++n<i;){var s=(a=r[n])[0],o=a[1],u=m.getObjectValue(s,t),c=m.getObjectValue(s,e);if(u>c)return"desc"===o?-1:1;if(u<c)return"asc"===o?-1:1}})}.call(this,t);var a=t.length;if(0!==a){var s=n,o=void 0;return void 0===s&&(s=0),s=Math.min(s,a),o=void 0===i?a:s+i,o=Math.min(o,a),t=t.slice(s,o)}this.target=[]},N.group=function(t){return!1==!!~this.params.group.indexOf(t)&&this.params.group.push(t),this},N.reset=function(){var t,r=this.source;return this.target=(t=r,JSON.parse(JSON.stringify(t))),this.params=Object.create(null),this.params.query=[],this.params.sort=[],this.params.field=Object.create(null),this.params.group=[],this.params.format=Object.create(null),this.params.range=[],this.queried=!1,this.indexes=Object.create(null),this},N.destroy=function(){this.target=null,this.params=null};var L=P;e.d(r,"default",function(){return L})}]).default});