/*!
 * query 1.0.0
 * (c) 2018 Smohan<https://smohan.net>
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Query",[],e):"object"==typeof exports?exports.Query=e():t.Query=e()}(this,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=Object.prototype.toString,o=[!0,1,"1","true"],s=[!1,0,"0","false"],a=["string","number","boolean","symbol"],u=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1,c=function(t){return"[object RegExp]"===i.call(t)},f=function(t){return"string"==typeof t},l=function(t){return void 0===t},p=function(t){return null===t},h=function(t){return!!(l(t)||p(t)||f(t)&&0===t.trim().length)},d=function(t){return"[object Object]"===i.call(t)},g=function(t){return Array.isArray.call(null,t)},y=function(t){return"number"==typeof t},b=function(t){return y(t)&&t%1==0},m=function(t){return f(t)&&(t=t.toLowerCase()),!!~o.indexOf(t)},v=function(t){return f(t)&&(t=t.toLowerCase()),!!~s.indexOf(t)},O=/(\^|\.|\[|\$|\(|\)|\||\*|\+|\?|\{|\\)/g;var x={regex:function(t,e){if(!c(t))throw TypeError("[VALIDATE ERROR]: The parameter reg must be a RegExp object");return!!t.test(e)},isRegexp:c,isString:f,isUndefined:l,isNull:p,isEmpty:h,isObject:function(t){return!p(t)&&"object"===(void 0===t?"undefined":n(t))},isPlainObject:d,isArray:g,isPrimitive:function(t){return!!~a.indexOf(void 0===t?"undefined":n(t))},isFunction:function(t){return"function"==typeof t},isNumber:y,isInteger:b,isFloat:function(t){return+t&&t!==(0|t)},isSafeInteger:function(t){return b(t)&&t>=-u&&t<=u},isTrue:m,isFalse:v,isBoolean:function(t){return m(t)||v(t)},escapeKeyword:function(t){return(t||"").toString().replace(O,"\\$1")},getObjectValue:function(t,e){if(!h(t)){for(var r=t.split(".");r.length&&(e=e[r.shift()],d(e)||g(e)););return e}}},j=["eq","neq","gt","gte","lt","lte","like","in","nin","exists"],S=["and","or"],w=["asc","desc"];function _(t,e){if(!(this instanceof _))return new _(t);x.isArray(t),this.source=t,this.reset()}_.version="1.0.0";var k=_.prototype;function q(t){var e=this.params.query,r=e.length;if(0===r)return!0;for(var n=!0,i=0;i<r;i++){var o=e[i],s=o._f,a=o._c,u=o._e,c=o._r,f=E(x.getObjectValue(s,t),u,a);n="or"===c?n||f:n&&f}return n}function E(t,e,r){var n=!0;switch(e){case"like":var i=new RegExp(x.escapeKeyword(r),"i");n=!!(t||"").toString().match(i);break;case"in":case"nin":break;case"neq":n=t!==r;break;case"lt":n=t<r;break;case"lte":n=t<=r;break;case"gt":n=t>r;break;case"gte":n=t>=r;break;case"eq":default:n=t===r}return n}function L(t,e){for(var r=this.params.sort,n=r.length,i=void 0;--n>=0;){if(r[n][0]===t){i=n;break}}var o=[t,e];i>-1&&this.params.sort.splice(i,1),this.params.sort.push(o)}function A(){var t=this.target,e=this.params,r=e.skip,n=e.limit;if(!this.queried){for(var i=[],o=-1,s=t.length,a=void 0,u=this.params.sort.length;++o<s;){a=t[o],q.call(this,a)&&i.push(a)}u&&function(t){var e=this.params.sort;t.sort(function(t,r){for(var n=-1,i=e.length,o=void 0;++n<i;){var s=(o=e[n])[0],a=o[1],u=x.getObjectValue(s,t),c=x.getObjectValue(s,r);if(u>c)return"desc"===a?-1:1;if(u<c)return"asc"===a?-1:1}})}.call(this,i),this.queried=!0;var c=i.length;if(0!==c){var f=r,l=void 0;void 0===f&&(f=0),f=Math.min(f,c),l=void 0===n?c:f+n,l=Math.min(l,c),i=i.slice(f,l),this.target=i}else this.target=[]}}k.skip=function(t){return this.params.skip=x.isInteger(t)&&t>0?t:0,this},k.limit=function(t){return this.params.limit=x.isInteger(t)?Math.abs(t):void 0,this},k.where=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"eq",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"and";if(!x.isString(t)||x.isEmpty(t))return this;if(null!==e&&void 0!==e&&!x.isPrimitive(e))throw new TypeError("Query: 参数condition必须是一个基本类型值");r=r.toLocaleLowerCase(),n=n.toLocaleLowerCase();var i={_f:t,_c:e,_e:r=~j.indexOf(r)?r:"eq",_r:n=~S.indexOf(n)?n:"and"};return~JSON.stringify(this.params.query).indexOf(JSON.stringify(i))||this.params.query.push(i),this},k.sort=function(t,e){var r=Object.create(null);for(var n in 1===arguments.length?x.isPlainObject(t)?r=t:r[t]="desc":r[t]=e,r){var i=r[n].toLocaleLowerCase();x.isString(n)&&~w.indexOf(i)&&L.call(this,n,i)}return this},k.count=function(){return A.call(this),this.target.length},k.find=function(){return A.call(this),this.target},k.reset=function(){var t;this.target=(t=this.source,JSON.parse(JSON.stringify(t))),this.params=Object.create(null),this.params.query=[],this.params.sort=[],this.queried=!1},k.destroy=function(){this.target=null,this.params=null};e.default=_}]).default});